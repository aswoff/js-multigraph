<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>canvas label rotation test</title>
<style type="text/css">
  input {
    width : 720px;
    float : left;
    margin-top : 9px;
  }
  .slider-div {
    float : left;
    width : 35px;
    height : 24px;
    border-right : 1px solid black;
    border-top : 1px solid black;
    border-bottom : 1px solid black;
    padding-top : 6px;
    text-align : center;
  }
  .slider-div-arrow {
    width : 0;
    height : 0;
    float : left;
    border-top: 16px solid transparent;
    border-bottom: 16px solid transparent;
    border-right: 10px solid #000;
    margin-left:3px;
  }
  .slider-label {
    float : left;
    margin-top : 5px;
    margin-right : 3px;
  }
  .slider-wrapper {
    position : relative;
    left : 20px;
    height : 32px;
    width : 865px;
    padding : 5px;
    border : 1px solid black;
  }
</style>
<script type="text/javascript" src="../lib/jermaine/build/jermaine.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery.mousewheel.js"></script>
<script type="text/javascript" src="../lib/jquery/jquery-embed.js"></script>
<script type="text/javascript" src="../lib/util/util.js"></script>
<script type="text/javascript" src="../lib/sprintf/sprintf-0.7-beta1.js"></script>
<script type="text/javascript" src="../lib/requestanimationframe/requestanimationframe.js"></script>
<script type="text/javascript" src="../src/utility_functions/parsing_functions.js"></script>
<script type="text/javascript" src="../src/utility_functions/serializing_functions.js"></script>
<script type="text/javascript" src="../src/utility_functions/validation_functions.js"></script>
<script type="text/javascript" src="../src/core/data_value.js"></script>
<script type="text/javascript" src="../src/core/data_measure.js"></script>
<script type="text/javascript" src="../src/core/data_formatter.js"></script>
<script type="text/javascript" src="../src/math/box.js"></script>
<script type="text/javascript" src="../src/math/displacement.js"></script>
<script type="text/javascript" src="../src/math/enum.js"></script>
<script type="text/javascript" src="../src/math/insets.js"></script>
<script type="text/javascript" src="../src/math/point.js"></script>
<script type="text/javascript" src="../src/math/rgb_color.js"></script>
<script type="text/javascript" src="../src/math/util.js"></script>
<script type="text/javascript" src="../src/core/renderer.js"></script>
<script type="text/javascript" src="../src/core/data_variable.js"></script>
<script type="text/javascript" src="../src/core/data.js"></script>
<script type="text/javascript" src="../src/core/plot.js"></script>
<script type="text/javascript" src="../src/core/array_data.js"></script>
<script type="text/javascript" src="../src/core/axis.js"></script>
<script type="text/javascript" src="../src/core/axis_title.js"></script>
<script type="text/javascript" src="../src/core/background.js"></script>
<script type="text/javascript" src="../src/core/binding.js"></script>
<script type="text/javascript" src="../src/core/constant_plot.js"></script>
<script type="text/javascript" src="../src/core/csv_data.js"></script>
<script type="text/javascript" src="../src/core/data_plot.js"></script>
<script type="text/javascript" src="../src/core/datatips.js"></script>
<script type="text/javascript" src="../src/core/datatips_variable.js"></script>
<script type="text/javascript" src="../src/core/datetime_formatter.js"></script>
<script type="text/javascript" src="../src/core/datetime_measure.js"></script>
<script type="text/javascript" src="../src/core/datetime_value.js"></script>
<script type="text/javascript" src="../src/core/filter.js"></script>
<script type="text/javascript" src="../src/core/filter_option.js"></script>
<script type="text/javascript" src="../src/core/graph.js"></script>
<script type="text/javascript" src="../src/core/graph_title.js"></script>
<script type="text/javascript" src="../src/core/grid.js"></script>
<script type="text/javascript" src="../src/core/icon.js"></script>
<script type="text/javascript" src="../src/core/img.js"></script>
<script type="text/javascript" src="../src/core/labeler.js"></script>
<script type="text/javascript" src="../src/core/legend.js"></script>
<script type="text/javascript" src="../src/core/mixin.js"></script>
<script type="text/javascript" src="../src/core/multigraph.js"></script>
<script type="text/javascript" src="../src/core/number_formatter.js"></script>
<script type="text/javascript" src="../src/core/number_measure.js"></script>
<script type="text/javascript" src="../src/core/number_value.js"></script>
<script type="text/javascript" src="../src/core/pan.js"></script>
<script type="text/javascript" src="../src/core/plot_legend.js"></script>
<script type="text/javascript" src="../src/core/plotarea.js"></script>
<script type="text/javascript" src="../src/core/renderers/band_renderer.js"></script>
<script type="text/javascript" src="../src/core/renderers/bar_renderer.js"></script>
<script type="text/javascript" src="../src/core/renderers/fill_renderer.js"></script>
<script type="text/javascript" src="../src/core/renderers/pointline_renderer.js"></script>
<script type="text/javascript" src="../src/core/renderers/rangebar_renderer.js"></script>
<script type="text/javascript" src="../src/core/service.js"></script>
<script type="text/javascript" src="../src/core/text.js"></script>
<script type="text/javascript" src="../src/core/variables.js"></script>
<script type="text/javascript" src="../src/core/web_service_data.js"></script>
<script type="text/javascript" src="../src/core/web_service_data_cache_node.js"></script>
<script type="text/javascript" src="../src/core/web_service_data_iterator.js"></script>
<script type="text/javascript" src="../src/core/window.js"></script>
<script type="text/javascript" src="../src/core/zoom.js"></script>
<script type="text/javascript" src="../src/parser/jquery/jquery_mixin.js"></script>
<script type="text/javascript" src="../src/parser/jquery/array_data.js"></script>
<script type="text/javascript" src="../src/parser/jquery/axis.js"></script>
<script type="text/javascript" src="../src/parser/jquery/axis_title.js"></script>
<script type="text/javascript" src="../src/parser/jquery/background.js"></script>
<script type="text/javascript" src="../src/parser/jquery/binding.js"></script>
<script type="text/javascript" src="../src/parser/jquery/csv_data.js"></script>
<script type="text/javascript" src="../src/parser/jquery/data.js"></script>
<script type="text/javascript" src="../src/parser/jquery/data_variable.js"></script>
<script type="text/javascript" src="../src/parser/jquery/datatips.js"></script>
<script type="text/javascript" src="../src/parser/jquery/datatips_variable.js"></script>
<script type="text/javascript" src="../src/parser/jquery/filter.js"></script>
<script type="text/javascript" src="../src/parser/jquery/filter_option.js"></script>
<script type="text/javascript" src="../src/parser/jquery/graph.js"></script>
<script type="text/javascript" src="../src/parser/jquery/graph_title.js"></script>
<script type="text/javascript" src="../src/parser/jquery/grid.js"></script>
<script type="text/javascript" src="../src/parser/jquery/icon.js"></script>
<script type="text/javascript" src="../src/parser/jquery/img.js"></script>
<script type="text/javascript" src="../src/parser/jquery/labeler.js"></script>
<script type="text/javascript" src="../src/parser/jquery/legend.js"></script>
<script type="text/javascript" src="../src/parser/jquery/multigraph.js"></script>
<script type="text/javascript" src="../src/parser/jquery/pan.js"></script>
<script type="text/javascript" src="../src/parser/jquery/parse_xml.js"></script>
<script type="text/javascript" src="../src/parser/jquery/plot.js"></script>
<script type="text/javascript" src="../src/parser/jquery/plot_legend.js"></script>
<script type="text/javascript" src="../src/parser/jquery/plotarea.js"></script>
<script type="text/javascript" src="../src/parser/jquery/renderer.js"></script>
<script type="text/javascript" src="../src/parser/jquery/service.js"></script>
<script type="text/javascript" src="../src/parser/jquery/variables.js"></script>
<script type="text/javascript" src="../src/parser/jquery/window.js"></script>
<script type="text/javascript" src="../src/parser/jquery/zoom.js"></script>

<script type="text/javascript" src="../src/graphics/canvas/canvas_mixin.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/axis.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/graph.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/icon.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/labeler.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/legend.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/multigraph.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/renderers/band_renderer.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/renderers/bar_renderer.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/renderers/fill_renderer.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/renderers/pointline_renderer.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/renderers/rangebar_renderer.js"></script>
<script type="text/javascript" src="../src/graphics/canvas/text.js"></script>

<script type="text/javascript" src="../src/events/jquery/mouse/mixin.js"></script>
<script type="text/javascript" src="../src/events/jquery/mouse/graph.js"></script>
<script type="text/javascript" src="../src/events/jquery/mouse/multigraph.js"></script>
<script type="text/javascript" src="../src/events/jquery/multigraph.js"></script>
<script type="text/javascript" src="../src/normalizer/normalizer_mixin.js"></script>
<script type="text/javascript" src="../src/normalizer/axis.js"></script>
<script type="text/javascript" src="../src/normalizer/data.js"></script>
<script type="text/javascript" src="../src/normalizer/graph.js"></script>
<script type="text/javascript" src="../src/normalizer/labeler.js"></script>
<script type="text/javascript" src="../src/normalizer/multigraph.js"></script>
<script type="text/javascript" src="../src/normalizer/plot.js"></script>

<script type="text/javascript">
  function showValue(value, id) {
//    document.getElementById(id + "-div").innerHTML = value;
  }
  
</script>

<script type="text/javascript">
  (function ($) {
      $(document).ready(function () {
          var createGraph = function (obj) {
              var div = obj.div;
              if (!obj.driver) {
                  obj.driver = "canvas";
              }
              if (typeof(div) === "string") {
                  // if div is a string, assume it's an id, and convert
                  // it to the div element itself
                  div = window.multigraph.jQuery("#" + div)[0];
              }
              if (!obj.errorHandler || typeof(obj.errorHandler) !== "function") {
                  obj.errorHandler = window.multigraph.core.Multigraph.createDefaultErrorHandler(div);
              }
              if (obj.driver === "canvas") {
                  createCanvasGraph(div, obj.mugl, obj.errorHandler);
              } else if (obj.driver === "raphael") {
                  createRaphaelGraph(div, obj.mugl, obj.errorHandler);
              }
              throw new Error("invalid graphic driver '" + obj.driver + "' specified to Multigraph.createGraph");
          };

          var createCanvasGraph = function (div, muglurl, errorHandler) {
              var muglPromise,
                  deferred;

              try {
                  window.multigraph.parser.jquery.mixin.apply(window.multigraph, "parseXML", "serialize");
                  window.multigraph.graphics.canvas.mixin.apply(window.multigraph.core);
                  window.multigraph.events.jquery.mouse.mixin.apply(window.multigraph, errorHandler);
                  window.multigraph.normalizer.mixin.apply(window.multigraph.core);

                  muglPromise = window.multigraph.jQuery.ajax({
                      "url"      : muglurl,
                      "dataType" : "text"
                  });

                  deferred = window.multigraph.jQuery.Deferred();
              }
              catch (e) {
                  errorHandler(e);
              }

              muglPromise.done(function (data) {
                  try {
                      var multigraph = window.multigraph.core.Multigraph.parseXML( window.multigraph.parser.jquery.stringToJQueryXMLObj(data) );
                      multigraph.normalize();
                      multigraph.div(div);
                      multigraph.init();
                      multigraph.registerMouseEvents(multigraph.canvas());
                      multigraph.registerCommonDataCallback(function () {
                          multigraph.redraw();
                      });
                      $(".slider").on("change", function () {
                          var i, j;
                          $("#" + this.id + "-div").html(this.value);
                          for (i = 0; i < multigraph.graphs().at(0).axes().size(); i++) {
                              for (j = 0; j < multigraph.graphs().at(0).axes().at(i).labelers().size(); j++) {
                                  multigraph.graphs().at(0).axes().at(i).labelers().at(j).angle(parseFloat(this.value));
                              }
                          }
                          multigraph.redraw();
                      });
                      deferred.resolve(multigraph);
                  }
                  catch (e) {
                      errorHandler(e);
                  }
              });

              return deferred.promise();

          };


          $("div.multigraph-rotation").each(function () {

              var width = $(this).attr("data-width"),
                  height = $(this).attr("data-height"),
                  src = $(this).attr("data-src"),
                  driver = $(this).attr("data-driver"),
                  options;

              if (width !== undefined) {
                  $(this).css('width', width + 'px');
              }
              if (height !== undefined) {
                  $(this).css('height', height + 'px');
              }
              if (driver === undefined) {
                  driver = "canvas";
              }

              options = {
                  'div'    : this,
                  'mugl'   : src,
                  'driver' : driver
              };

              if (src !== undefined) {
                  createGraph(options);
              }
          });
      });

      
  }(window.multigraph.jQuery));
</script>

</head>
<body>

  <div id="dashboard-soi" class="multigraph-rotation" data-src="../spec/mugl/dashboard-soi.xml" data-width="800" data-height="400" data-driver="canvas"></div>


<div class="slider-wrapper">
  <div class="slider-label">Labeler 0: </div>
  <input id="labeler-0" class="slider" type="range" min="-360" max="360" value="0"/>
  <div class="slider-div-arrow"></div>
  <div id="labeler-0-div" class="slider-div">0</div>
</div>

<br />

<a href="index-raphael.html">raphael</a>

</body>
</html>
